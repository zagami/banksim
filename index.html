<!DOCTYPE html>
<html>
<head>
 <!--JS Libraries -->
  <!-- jQuery -->
  <script src="lib/jquery-2.1.4.js"></script>

  <!-- Knockout.js -->
  <script src="lib/knockout-min.js"></script>
  <script src="lib/knockout.mapping.min.js"></script>

  <!-- highcharts -->
  <script src="lib/highcharts.js"></script>
  <script src="lib/exporting.js"></script>


  <!-- vis -->
  <script src="lib/vis.js"></script>
  <link rel="stylesheet" type="text/css" href="lib/vis.css">

  <script src="lib/hashtable.js"></script>

  <!-- stylesheet -->

  <link rel="stylesheet" type="text/css" href="css/style.css">
 
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- application -->
  <script src="src/microeconomy.js"></script>
  <script src="src/banksim.js"></script>
  
  <title>BankSim</title>
</head>

<body>

  <a href=":blank" data-bind="click: lang_de_clicked">DE</a>
  <a href=":blank" data-bind="click: lang_en_clicked">EN</a>
  <a href=":blank" data-bind="click: instructions_clicked">Instructions (F1)</a>
  <h1>BankSim</h1>

<div id="controls">
  <h2><span id="lbl_1"></span>: <span data-bind="text: step"></span></h2>
  <form>
  <fieldset>
    <legend><span id="lbl_2"></span></legend>
    <button type="button" data-bind="click: simulate_clicked"><span id="lbl_4"></span></button>
    <div class="form_group">
      <label for="years_per_step"><span id="lbl_5"></span>:</label>
      <input id="years_per_step" type="range" min=1 max=100 step=5 data-bind="value: years_per_step">
      <span data-bind="text: years_per_step"></span>
    </div>
    <div class="form_group">
      <label for="autorun"><span id="lbl_6"></span>:</label>
      <input id="autorun" type="checkbox" data-bind="checked: autorun, click: autorun_clicked">
    </div>
    <button type="button" data-bind="click: reset_clicked"><span id="lbl_7"></span></button>
  </fieldset>
  </form>
</div>

<div id="params">

  <form>
    <fieldset>
      <legend><span id="lbl_3"></span></legend>
      <fieldset>
        <legend><span id="lbl_23"></span></legend>
        <div class="form_group">
          <label for="prime_rate"><span id="lbl_8"></span>:</label>
          <input id="prime_rate" type="range" min=0 max=15 step=1 data-bind="value: prime_rate">
          <span data-bind="text: prime_rate"></span>%

        </div>
        <div class="form_group">
          <label for="prime_rate_giro"><span id="lbl_9"></span>:</label>
          <input id="prime_rate_giro" type="range" min=-10 max=15 step=1 data-bind="value: prime_rate_giro">
          <span data-bind="text: prime_rate_giro"></span>%
        </div>
      </fieldset>

      <!--<div class="form_group">-->
        <!--<label for="minimal_reserves"><span id="lbl_12"></span>:</label>-->
        <!--<input id="minimal_reserves" type="range" min=0 max=50 step=1 data-bind="value: minimal_reserves">-->
        <!--<span data-bind="text: minimal_reserves"></span>%-->
      <!--</div>-->

      <!--<div class="form_group">-->
        <!--<label for="cap_req"><span id="lbl_11"></span>:</label>-->
        <!--<input id="cap_req" type="range" min=0 max=50 step=1 data-bind="value: cap_req">-->
        <!--<span data-bind="text: cap_req"></span>%-->
      <!--</div>-->

      <fieldset>
        <legend><span id="lbl_24"></span></legend>
      <div class="form_group">
        <label for="libor"><span id="lbl_10"></span>:</label>
        <input id="libor" type="range" min=0 max=15 step=1 data-bind="value: libor">
        <span data-bind="text: libor"></span>%
      </div>

      <div class="form_group">
        <label for="credit_interest"><span id="lbl_13"></span>:</label>
        <input id="credit_interest" type="range" min=0 max=10 step=1 data-bind="value: credit_interest">
        <span data-bind="text: credit_interest"></span>%
      </div>

      <div class="form_group">
        <label for="deposit_interest"><span id="lbl_14"></span>:</label>
        <input id="deposit_interest" type="range" min=-10 max=10 step=1 data-bind="value: deposit_interest">
        <span data-bind="text: deposit_interest"></span>%
      </div>

      <div class="form_group">
        <label for="deposit_interest_savings"><span id="lbl_15"></span>:</label>
        <input id="deposit_interest_savings" type="range" min=-10 max=10 step=1 data-bind="value: deposit_interest_savings">
        <span data-bind="text: deposit_interest_savings"></span>%
      </div>

      <div class="form_group">
        <label for="savings_rate"><span id="lbl_16"></span>:</label>
        <input id="savings_rate" type="range" min=0 max=100 step=1 data-bind="value: savings_rate">
        <span data-bind="text: savings_rate"></span>%
      </div>
      </fieldset>

      <fieldset>
        <legend><span id="lbl_25"></span></legend>
      <div class="form_group">
        <label for="income_tax_rate"><span id="lbl_17"></span>:</label>
        <input id="income_tax_rate" type="range" min=0 max=100 step=1 data-bind="value: income_tax_rate">
        <span data-bind="text: income_tax_rate"></span>%
      </div>

      <div class="form_group">
        <label for="wealth_tax_rate"><span id="lbl_18"></span>:</label>
        <input id="wealth_tax_rate" type="range" min=0 max=100 step=1 data-bind="value: wealth_tax_rate">
        <span data-bind="text: wealth_tax_rate"></span>%
      </div>

      <div class="form_group">
        <label for="gov_spending"><span id="lbl_19"></span>:</label>
        <input id="gov_spending" type="range" min=0 max=100 step=1 data-bind="value: gov_spending">
        <span data-bind="text: gov_spending"></span>%
      </div>

      <div class="form_group">
        <label for="basic_income_rate"><span id="lbl_20"></span>:</label>
        <input id="basic_income_rate" type="range" min=0 max=100 step=1 data-bind="value: basic_income_rate">
        <span data-bind="text: basic_income_rate"></span>%
      </div>
    </fieldset>
    <fieldset>
      <legend><span id="lbl_21"></span></legend>
    <div class="form_group">
      <label for="chk_positive_money"><span id="lbl_22"></span>:</label>
      <input id="chk_positive_money" type="checkbox" data-bind="checked: positive_money, click: positive_money_clicked">
    </div>
    </fieldset>
    </fieldset>

  </form>
</div>

<div id="viz">
  <div id="charts">
    <div id="main_chart"></div> 
    <div id="ms_chart1"></div>
    <div id="ms_chart2"></div>
    <div id="infl_chart"></div>
    <div id="taxes_chart"></div>
    <div id="wealth_chart"></div>
    <div id="banks_chart"></div>
    <div id="banks_chart2"></div>
    <div id="banks_chart3"></div>
    <div id="interest_graph"></div>
  </div>

  <div id="tables">
    <div id="cb_table"></div>
    <div id="ms_table"></div>
    <div id="stats_table"></div>
    <div id="customers_table"></div>
    <div id="banks_table"></div>
  </div>
</div>

<script type="text/javascript" src="lib/shortcut.js"></script>
<script>
<!--http://stackoverflow.com/questions/5061353/how-to-create-a-keyboard-shortcut-for-an-input-button-->
    shortcut.add("n", function() {
        // Do something
        simulator.simulate_clicked();
    }); 
    shortcut.add("r", function() {
        // Do something
        simulator.reset_clicked();
    });  
    shortcut.add("a", function() {
        // Do something
        simulator.autorun_clicked();
    });  
    shortcut.add("F1", function() {
      $('.instructions').slideToggle();
    });  
    
</script>

<div class="instructions">
<div id="instructions_english">
# Money Simulator

## Shortcuts

* You can press **n** to simulate one step
* You can press **r** to reset the simulation
* You can press **a** to toggle Autorun mode

## Assuptions of the simulation

- There is 1 central bank
- There is a fixed number of banks
- All money is book money, there is no cash for simplicity
- Customers have only 1 bank account
- The simulation runs year by year. For every year, the following steps will be performed:
  * for every transaction type a random number of transactions is performed

### PAYMENTS, ECONOMIC ACTIVITY BETWEEN NONBANKS
  - the amount of each payment is random 
  - 2 random banks are randomly chosen for each transaction
  - its upper limit is the amount of bank deposits
  - there is no withdrawal limit except bank deposit
  - if a bank has not enough reserves to make the transaction it can take a loan from the central bank (prime rate) or from the target bank (libor rate), depending on which rate is lower. Interbank loans are preferred if rates are equal.

### CUSTOMER DEPOSITS AND LOANS

  - the interest rates for deposits and loans are fixed for every bank, there is no market yet
  - overdrafts: a negative deposit is not possible, this  would be equivalent to a loan
  - customers are assigned a equal loan at the start
    * the loans are not yet secured by collaterals
    * customers don't have to be elligible for a loan

  - customers can pay back their loans every year:
    * customers only pay back their loans with their savings if savings rate is below interest rate for loans.
    * the payback amount is up to the customer, there are no restrictions
  - customers are saving their money on a savings account, according to a savings rate.

### INTERBANK LOANS
  - the libor rate is fixed for every bank, there is no market yet
  - there is no upper limit for interbank loans 
  - interbank loans are payed back randomly, if reserves allow it
  - interbank loans are not swapped to central bank loans if libor rate is higher than prime rate

### CENTRAL BANK DEPOSITS AND LOANS
  - the prime rates are the main parameters of the simulation
  - interest rates can vary each year
  - the loans are not yet secured by collaterals of the banks
  - the banks decide when and how much to payback loans to central banks
  - the central bank will provide as many loans as requested by banks

### BANKRUPCY OF CUSTOMER
  - since the loans are not secured, a customer can always extend their loans by the remaining interest debt (compound interest)

### BANKRUPCY OF BANK
  - a bank cannot get bankrupt, there are no minimal reserves requirements yet, nor capital requirements 

### STATE
  - the state has a bank account at the central bank
  - the state can tax the nonbanks by income or wealth
  - the state cannot tax banks yet
  - the state can provide a basic income to its citizens

Customers will be subdivided into Persons and Corporations soon.

Transactions in () are not implemented yet

Customer - Customer
  * payment
    - innerbank transfer 
    - interbank transfer 
      -> triggers interbank settlement
  * (new private loan) 
  * (pay interest for private loan) 
  * (payback private loan)

Bank -> Customer
  * pay deposit interest
  * new loan
   
Customer -> Bank
  * loan interest (-> can trigger new customer loan, paying interest with new debt)
  * payback loan

Bank -> Bank
  * interbank payment settlement (can trigger new ib or cb loan)
  * new interbank loan
  * pay interbank interest (can trigger new ib or cb loan)
  * payback interbank loan

Central Bank -> Bank
  * pay interest for giro deposit
  * new central bank credit

Bank -> Central Bank
  * pay interest for central bank credit
  * payback central bank credit


# Formulas

VOC:
personal loans: private Darlehen 
corporate bonds: Obligation?
overdraft: if account "overdrawn"
to default: pleite gehen

In finance, a loan is a debt provided by an entity (organization or individual) to another entity at an interest rate, and evidenced by a note which specifies, among other things, the principal amount, interest rate, and date of repayment. A loan entails the reallocation of the subject asset(s) for a period of time, between the lender and the borrower.

The borrower is obligated to pay back or repay an equal amount of money to the lender at a later time.

A secured loan is a loan in which the borrower pledges some asset (e.g. a car or property) as collateral.

</div>

<div id="instructions_german">
# Dies ist die deutsche Anleitung

- Keine Kontoführungsgebühren
- Kein Wertschriftengeschaeft (Investmentbanking?)
- Liquiditätsanforderungen
</div>
</div>

<!-- markdown parser -->
<script src="lib/marked.js"></script>
<script>
  // Generate Markdown
  var d_markdown = document.getElementById('instructions_german').innerHTML;
  var html = marked(d_markdown);
  document.getElementById('instructions_german').innerHTML = html;
  e_markdown = document.getElementById('instructions_english').innerHTML;
  html = marked(e_markdown);
  document.getElementById('instructions_english').innerHTML = html;
</script>

</body>
</html>
