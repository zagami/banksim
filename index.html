<!DOCTYPE html>
<html>
<head>
 <!--JS Libraries -->
  <!-- jQuery -->
  <script src="lib/jquery-2.1.4.js"></script>

  <!-- Knockout.js -->
  <script src="lib/knockout-min.js"></script>
  <script src="lib/knockout.mapping.min.js"></script>

  <!-- highcharts -->
  <script src="lib/highcharts.js"></script>
  <script src="lib/exporting.js"></script>

  <!-- vis -->
  <script src="lib/vis.js"></script>
  <link rel="stylesheet" type="text/css" href="lib/vis.css">

  <script src="lib/hashtable.js"></script>

  <!-- stylesheet -->
  <link rel="stylesheet" type="text/css" href="css/style.css">
 
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- application -->
  <script src="src/microeconomy.js"></script>
  <script src="src/banksim.js"></script>
  
  <title>BankSim</title>
</head>

<body>

<h1>BankSim</h1>

<div id="left">

<div id="controls">

  <a href=":blank" data-bind="click: lang_de_clicked">DE</a>
  <a href=":blank" data-bind="click: lang_en_clicked">EN</a>

  <h2>Steuerung</h2>
  <table>
    <tr>
      <td colspan=2><input type="button" value="Simulate" data-bind="click: simulate_clicked"/></td>
    </tr>
    <tr>
      <td class="label">Jahre pro Schritt: </td>
      <td><input data-bind="value: yearsPerStep" id="slider1" type="range" min="1" max="100" step="5" /> <span data-bind="text: yearsPerStep"></span>
      </td>
    </tr>
    <tr>
      <td class="label">Autorun</td>
      <!--<td><button  data-bind='text: autorun, click: autorun_clicked'></button></td>-->
      <td><input type="checkbox" id="autorun_chk" data-bind="checked: autorun, click: autorun_clicked"> </td>
    </tr>
    <tr>
      <td><input type="button" value="Reset" data-bind="click: reset_clicked"/></td>
      <td><input type="text" data-bind="value: step"/></td>
    </tr>
  </table>
</div>

<div id="params">
  <h2>Parameter</h2>
  <table>
    <tr>
      <td class="label">Leitzins: ZB Kredite</td>
      <td><input data-bind="value: prime_rate" id="slider_lz" type="range" min="0" max="15" step="0.1" /> <span data-bind="text: prime_rate"></span>%</td>
    </tr>

    <tr>
      <td class="label">Leitzins: ZB Konten</td>
      <td><input data-bind="value: prime_rate_giro" id="slider_lzg" type="range" min="0" max="15" step="0.1" /> <span data-bind="text: prime_rate_giro"></span>%</td>
    </tr>
    <tr>
      <td class="label">LIBOR</td>
      <td><input data-bind="value: libor" id="slider_libor" type="range" min="0" max="15" step="0.1" /> <span data-bind="text: libor"></span>%</td>
    </tr>
    <tr>
      <td class="label">Eigenkapitalvorschrift</td>
      <td><input data-bind="value: cap_req" id="slider_lz" type="range" min="0" max="50" step="1" /> <span data-bind="text: cap_req"></span>%</td>
    </tr>
    <tr>
      <td class="label">Mindestreserve</td>
      <td><input data-bind="value: minimal_reserves" id="slider_lz" type="range" min="0" max="50" step="1" /> <span data-bind="text: minimal_reserves"></span>%</td>
    </tr>
    <tr>
      <td class="label">Kreditzinsen</td>
      <td><input data-bind="value: credit_interest" id="slider_lz" type="range" min="0" max="10" step="0.1" /> <span data-bind="text: credit_interest"></span>%</td>
    </tr>
    <tr>
      <td class="label">Guthabenszinsen</td>
      <td><input data-bind="value: deposit_interest" id="slider_lz" type="range" min="0" max="10" step="0.1" /> <span data-bind="text: deposit_interest"></span>%</td>
    </tr>

  </table>
</div>
</div>

<div id="viz">
  <div id="graphs">
    <div id="cb_chart"></div> 
    <div id="banks_total_chart"></div> 
    <div id="customers_total_chart"></div> 
    <div id="stats_chart1"></div>
    <div id="stats_chart2"></div>
    <div id="wealth_chart"></div>
    <div id="banks_chart"></div>
    <div id="banks_chart2"></div>
    <div id="interest_graph" class='graph'></div>
  </div>

  <div id="tables">
    <div id="cb_table"></div>
    <div id="ms_table"></div>
    <div id="state_table"></div>
    <div id="banks_table"></div>
  </div>
</div>

<script type="text/javascript" src="lib/shortcut.js"></script>

<script>
<!--http://stackoverflow.com/questions/5061353/how-to-create-a-keyboard-shortcut-for-an-input-button-->
    shortcut.add("n", function() {
        // Do something
        simulator.simulate_clicked();
    }); 
    shortcut.add("r", function() {
        // Do something
        simulator.reset_clicked();
    });  
    shortcut.add("a", function() {
        // Do something
        simulator.autorun_clicked();
    });  
</script>

<div id="foo" style= "clear: both">
</div>

<div id="instructions">
<pre>

# Money Simulator

## Shortcuts

* You can press **n** to simulate one step
* You can press **r** to reset the simulation
* You can press **a** to toggle Autorun mode

## Assuptions of the simulation

- There is 1 central bank
- There is a fixed number of banks
- All money is book money, there is no cash for simplicity
- Customers have only 1 bank account
- The simulation runs year by year. For every year, the following steps will be performed:
  * for every transaction type a random number of transactions is performed
  * a check is made which bank has gone bankrupt
  * depending on the write offs, a chain reaction for other banks can follow
  * if the central bank has a negative capital, the simulation stops

### PAYMENTS CC1
    - the amount of each payment is random 
    - 2 random banks are chosen for each transaction
    - its upper limit is the amount of bank deposits
    - there is no withdrawal limit except bank deposit
    - if a bank has not enough reserves to make the transaction it can take a loan from the central bank (prime rate) or from the target bank (libor rate)
    - if the target bank has enough reserves to give an interbank credit it will be preferred over a central bank credit, if the libor is below the prime rate

### CUSTOMER DEPOSITS AND LOANS BC1, BC2, CB1, CB2

  - the interest rates for deposits and loans are fixed for every bank, there is no market yet

  - overdrafts: a negative deposit is not possible, this is the same as a loan

  - customers are taking loans every year:
    * the loans are not yet secured by collaterals
    * customers don't have to be elligible for a loan
    * the amount is random with an upper limit based on the credit potential of the bank. This potential is computed according to the capital and reserve requirements of the bank. 
    * customers take maximal loan they can get without further consideration
    * TODO: upper limit determined by deposits of customer? > interest rates?

  - customers can pay back their loans every year:
    * the payback amount is random
    * the upper limit is of course the available bank deposits

### INTERBANK LOANS
  - the libor rate is fixed for every bank, there is no market yet
  - there is no upper limit for interbank loans 
  - interbank loans are not payed back
  - TODO: pay back interbank loans if libor > prime rate and enough reserves

### CENTRAL BANK DEPOSITS AND LOANS
  - the prime rates are the main parameters of the simulation
  - the loans are not secured by collaterals of the banks
  - the central bank will provide as many loans as requested by banks, but the capital of the central bank must allow it

### BANKRUPCY OF CUSTOMER
  - since the loans are not secured, the bank will seize the remaining deposits and write off the rest as a loss
  - customers are not implemented as individuals yet, only as an aggregate

### BANKRUPCY OF BANK
  - A bank can go bankrupt if...
      * the capital requirements cannot be met 
      * the minimal reserves requirements cannot be met
  
  - The debts of the bank to the central bank, other banks or  customers are lost if it goes bankrupt, the money supply  M0 and M1 shrinks accordingly
  - A bank that is bankrupt is out of the game for good

### BASEL II
  - minimal reserves requirements are in relation to the customer deposits, central bank debt and interbank debt

  - capital requirements are in relation to all liabilities (leverage ratio), not as in BASEL II only to a subset of risky assets


## Transactions
Transactions in () are not implemented yet

Customers will be subdivided into Persons and Corporations soon.

Customer - Customer
  * payment
    - innerbank transfer 
    - interbank transfer 
      -> triggers interbank settlement
  * (new private loan) 
  * (pay interest for private loan) 
  * (payback private loan)

Bank -> Customer
  * pay deposit interest
  * new loan
   
Customer -> Bank
  * credit interest (-> can trigger new customer loan, paying interest with new debt)
  * payback loan

Bank -> Bank
  * interbank payment settlement (can trigger new ib or cb loan)
  * new interbank loan
  * pay interbank interest (can trigger new ib or cb loan)
  * payback interbank loan

Central Bank -> Bank
  * pay interest for giro deposit
  * new central bank credit

Bank -> Central Bank
  * pay interest for central bank credit
  * payback central bank credit


# Formulas

MR = Minimal Reserve Requirement
CR = Capital Requirement

MR < B.Reserves / (B.CB_Debt + B.IB_Debt + B.Giral)
CR < B.Capital / B.Liabilities

upper limit for customer loans:

X: new loan to customer
B.Debt = (B.CB_Debt + B.IB_Debt + B.Giral)

MR < B.Reserves / (B.CB_Debt + B.IB_Debt + (B.Giral + X))
=> MR * (B.Debt + X) < B.Reserves
=> MR * X < B.Reserves - MR * B.Debt
=> X < (B.Reserves - MR * B.Debt) / MR

CR < B.Assets + X - (B.Debt + X) / (B.Liabilities + X) 
=> CR * B.Liabilities + CR * X < B.Assets - B.Debt
=> CR * X < B.Capital - CR * Liabilities
=> X < (B.Capital - CR * Liabilities) / CR

the minimum of these 2 upper limits determine the max. possible new customer loan

upper limit for new ib or cb loans:

X: new ib or cb loan

new ib / cb loans are always beneficial to reserve requirements (if B.Reserves < B.Debt)

X < (B.Capital - CR * Liabilities) / CR
(same formula as for customer loans)

upper limit for payback of ib / cb loans:

X: payback amount

MR < (B.Reserves - X) / (B.Debt - X)
=> MR * B.Debt - MR * X < B.Reserves - X
=> X * (1 - MR) < B.Reserves - MR * B.Debt
=> X < (B.Reserves - MR * B.Debt) / (1 - MR)

paying back loans is always beneficial to capital requirements
if prime rate deposit is good, what is minimal amount needed?
     x = 1/cr * ((cr-1)*B.Assets - B.Debt)

VOC:
personal loans: private Darlehen 
corporate bonds: Obligation?
overdraft: if account "overdrawn"
to default: pleite gehen

In finance, a loan is a debt provided by an entity (organization or individual) to another entity at an interest rate, and evidenced by a note which specifies, among other things, the principal amount, interest rate, and date of repayment. A loan entails the reallocation of the subject asset(s) for a period of time, between the lender and the borrower.

The borrower is obligated to pay back or repay an equal amount of money to the lender at a later time.

A secured loan is a loan in which the borrower pledges some asset (e.g. a car or property) as collateral.
</pre>
</div>
</body>
</html>
